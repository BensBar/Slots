<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enhanced 4K 3-Reel Slot Machine Game</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #111;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            color: white;
            font-family: Arial, sans-serif;
        }
        #game-container {
            position: relative;
            width: 100%;
            max-width: 1920px; /* Optimized for 4K, responsive */
            aspect-ratio: 16/9;
            overflow: hidden;
        }
        #slot-canvas {
            width: 100%;
            height: 100%;
            background-color: #222;
        }
        #controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            padding: 10px;
            background-color: #333;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }
        #balance {
            font-size: 2em;
            margin-bottom: 10px;
        }
        #spin-button {
            padding: 15px 30px;
            font-size: 1.5em;
            background-color: #ff4500;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 5px;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        #spin-button:hover {
            transform: scale(1.05);
            box-shadow: 0 0 15px #ff4500;
        }
        #spin-button:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        #message {
            font-size: 1.5em;
            margin-top: 10px;
            color: #ffd700;
            text-shadow: 0 0 5px #ffd700;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <canvas id="slot-canvas"></canvas>
    </div>
    <div id="controls">
        <div id="balance">Balance: 1000</div>
        <button id="spin-button">Spin (Bet: 10)</button>
        <div id="message"></div>
    </div>
    <audio id="spin-sound" src="data:audio/mpeg;base64,//MUXEXYZ+... (base64 encoded spin sound)"></audio> <!-- Placeholder; in real, embed or link audio -->
    <audio id="win-sound" src="data:audio/mpeg;base64,//MUXEXYZ+... (base64 encoded win sound)"></audio> <!-- Placeholder -->
    <script>
        // Enhanced Slot Machine Game Logic with 4K Sizzle
        const canvas = document.getElementById('slot-canvas');
        const ctx = canvas.getContext('2d');
        const spinButton = document.getElementById('spin-button');
        const balanceElem = document.getElementById('balance');
        const messageElem = document.getElementById('message');
        const spinSound = document.getElementById('spin-sound');
        const winSound = document.getElementById('win-sound');

        // Game Constants - Updated for 3-reel configuration
        const REELS = 3; // Classic 3-reel slot machine
        const ROWS = 3;
        const SYMBOL_SIZE = 150; // Base size, scaled for 4K
        const SYMBOLS = ['🍒', '🍋', '🍉', '🔔', '⭐', '7', 'BAR', '💎']; // Classic symbols
        const REEL_STRIP_LENGTH = SYMBOLS.length * 4; // Longer strip for smoother spins
        const SPIN_DURATION = 2500; // Slightly longer for drama
        const BET_AMOUNT = 10;
        const PAYTABLE = {
            '🍒🍒🍒': 20,
            '🍋🍋🍋': 30,
            '🍉🍉🍉': 40,
            '🔔🔔🔔': 50,
            '⭐⭐⭐': 100,
            '777': 200,
            'BARBARBAR': 500,
            '💎💎💎': 1000 // Jackpot symbol
        };
        const PAYLINES = [
            [1,1,1], // Middle horizontal
            [0,0,0], // Top horizontal
            [2,2,2], // Bottom horizontal
            [0,1,2], // Diagonal top-left to bottom-right
            [2,1,0]  // Diagonal top-right to bottom-left
        ];

        // Game State
        let balance = 1000;
        let isSpinning = false;
        let reelPositions = Array(REELS).fill(0);
        let reelVelocities = Array(REELS).fill(0);
        let reelTargets = Array(REELS).fill(0);
        let reelStrips = Array(REELS).fill().map(() => generateReelStrip());
        let lastFrameTime = 0;
        let particles = []; // For win effects

        // Scale for 4K/high-DPI
        function resizeCanvas() {
            const dpr = window.devicePixelRatio || 1;
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width * dpr;
            canvas.height = rect.height * dpr;
            ctx.scale(dpr, dpr);
            render();
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // Generate reel strip
        function generateReelStrip() {
            let strip = [];
            for (let i = 0; i < 4; i++) {
                strip = strip.concat(SYMBOLS.sort(() => Math.random() - 0.5));
            }
            return strip;
        }

        // Render
        function render() {
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            const reelWidth = width / REELS;
            const rowHeight = height / ROWS;
            const symbolSize = Math.min(reelWidth * 0.8, rowHeight * 0.8);
            const marginX = (reelWidth - symbolSize) / 2;
            const marginY = (rowHeight - symbolSize) / 2;

            ctx.clearRect(0, 0, width, height);

            // Draw reel backgrounds with gradient for sizzle
            const gradient = ctx.createLinearGradient(0, 0, 0, height);
            gradient.addColorStop(0, '#444');
            gradient.addColorStop(1, '#222');
            for (let i = 0; i < REELS; i++) {
                ctx.fillStyle = gradient;
                ctx.fillRect(i * reelWidth, 0, reelWidth, height);
            }

            // Draw symbols with shadow for depth
            for (let reel = 0; reel < REELS; reel++) {
                for (let row = -1; row <= ROWS; row++) {
                    const pos = (reelPositions[reel] + row + REEL_STRIP_LENGTH) % REEL_STRIP_LENGTH;
                    const symbol = reelStrips[reel][Math.floor(pos)];
                    const frac = pos % 1;
                    const x = reel * reelWidth + marginX;
                    const y = row * rowHeight + (frac * rowHeight) + marginY;

                    ctx.font = `${symbolSize}px Arial`;
                    ctx.fillStyle = 'white';
                    ctx.shadowColor = 'rgba(0,0,0,0.5)';
                    ctx.shadowBlur = 5;
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(symbol, x + symbolSize / 2, y + symbolSize / 2);
                    ctx.shadowBlur = 0;
                }
            }

            // Draw paylines
            ctx.strokeStyle = 'rgba(255,215,0,0.3)';
            ctx.lineWidth = 4;
            for (let line of PAYLINES) {
                ctx.beginPath();
                for (let i = 0; i < REELS; i++) {
                    const x = i * reelWidth + reelWidth / 2;
                    const y = line[i] * rowHeight + rowHeight / 2;
                    if (i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();
            }

            // Render particles for win sizzle
            particles.forEach(p => {
                ctx.fillStyle = `rgba(255,215,0,${p.alpha})`;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                ctx.fill();
                p.y -= p.speed;
                p.alpha -= 0.01;
                p.size += 0.1;
            });
            particles = particles.filter(p => p.alpha > 0);
        }

        // Animation loop
        function animate(time) {
            if (!lastFrameTime) lastFrameTime = time;
            const delta = (time - lastFrameTime) / 16; // Normalize to 60fps
            lastFrameTime = time;

            if (isSpinning) {
                let stillSpinning = false;
                for (let i = 0; i < REELS; i++) {
                    if (reelVelocities[i] > 0) {
                        reelPositions[i] += reelVelocities[i] * delta;
                        // Ease out near target
                        const dist = (reelTargets[i] - reelPositions[i] + REEL_STRIP_LENGTH) % REEL_STRIP_LENGTH;
                        if (dist < 5) reelVelocities[i] *= 0.95; // Decelerate
                        if (reelVelocities[i] < 0.01) {
                            reelVelocities[i] = 0;
                            reelPositions[i] = reelTargets[i];
                        }
                        reelPositions[i] %= REEL_STRIP_LENGTH;
                        stillSpinning = true;
                    }
                }
                if (!stillSpinning) {
                    isSpinning = false;
                    spinButton.disabled = false;
                    checkWins();
                }
            }

            render();
            requestAnimationFrame(animate);
        }
        requestAnimationFrame(animate);

        // Start spin
        function startSpin() {
            if (balance < BET_AMOUNT) {
                messageElem.textContent = 'Insufficient balance!';
                return;
            }
            balance -= BET_AMOUNT;
            updateBalance();
            messageElem.textContent = '';
            isSpinning = true;
            spinButton.disabled = true;
            // spinSound.play(); // Uncomment with real audio

            for (let i = 0; i < REELS; i++) {
                reelVelocities[i] = 1.0 + Math.random() * 0.5; // Variable speed
                reelTargets[i] = Math.floor(Math.random() * REEL_STRIP_LENGTH);
                setTimeout(() => {}, SPIN_DURATION + i * 300); // Staggered, but stop logic in animate
            }
        }

        // Check multiple paylines
        function checkWins() {
            let totalPayout = 0;
            const grid = getGrid();

            for (let line of PAYLINES) {
                const symbols = line.map((row, reel) => grid[row][reel]);
                const key = symbols.join('');
                const payout = PAYTABLE[key] || 0;
                if (payout > 0) totalPayout += payout;
            }

            if (totalPayout > 0) {
                balance += totalPayout * BET_AMOUNT;
                messageElem.textContent = `Big Win! ${totalPayout}x bet = ${totalPayout * BET_AMOUNT}`;
                // winSound.play();
                createParticles();
            } else {
                messageElem.textContent = 'No win. Spin again!';
            }
            updateBalance();
        }

        function getGrid() {
            const grid = Array.from({length: ROWS}, () => Array(REELS).fill(''));
            for (let reel = 0; reel < REELS; reel++) {
                for (let row = 0; row < ROWS; row++) {
                    const pos = (Math.floor(reelPositions[reel]) + row) % REEL_STRIP_LENGTH;
                    grid[row][reel] = reelStrips[reel][pos];
                }
            }
            return grid;
        }

        // Particle explosion for wins
        function createParticles() {
            const width = canvas.clientWidth;
            const height = canvas.clientHeight;
            for (let i = 0; i < 50; i++) {
                particles.push({
                    x: Math.random() * width,
                    y: height,
                    size: Math.random() * 5 + 1,
                    speed: Math.random() * 2 + 1,
                    alpha: 1
                });
            }
        }

        function updateBalance() {
            balanceElem.textContent = `Balance: ${balance}`;
        }

        spinButton.addEventListener('click', startSpin);
    </script>
</body>
</html>